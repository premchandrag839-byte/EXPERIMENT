"use strict";(()=>{var t={};t.id=340,t.ids=[340],t.modules={1185:t=>{t.exports=require("mongoose")},145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(t,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function t(e,n){return n in e?e[n]:"then"in e&&"function"==typeof e.then?e.then(e=>t(e,n)):"function"==typeof e&&"default"===n?e:void 0}}})},2894:(t,e,n)=>{n.r(e),n.d(e,{config:()=>c,default:()=>l,routeModule:()=>p});var r={};n.r(r),n.d(r,{default:()=>u});var i=n(1802),a=n(7153),o=n(6249),d=n(9212),s=n(6754);async function u(t,e){if(await (0,d.Q)(),"GET"===t.method){let{page:n="1",limit:r="10"}=t.query,i=Math.max(parseInt(n,10)||1,1),a=Math.min(Math.max(parseInt(r,10)||10,1),50),o=await s.Z.countDocuments(),d=await s.Z.find({}).sort({date:-1,createdAt:-1}).skip((i-1)*a).limit(a).lean(),u=t=>{let e=new Date(t),n=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),i=String(e.getUTCDate()).padStart(2,"0");return`${n}-${r}-${i}`},l=d.map(t=>({id:t._id.toString(),title:t.title,date:u(t.date),description:t.notice||""}));return e.status(200).json({ok:!0,items:l,total:o,page:i,limit:a})}if("POST"===t.method){let{title:n,date:r,description:i,notice:a}=t.body||{};if(!n||!r)return e.status(400).json({ok:!1,error:"Title and date required"});let o={title:String(n).slice(0,80),notice:(a??i??"").toString(),date:new Date(`${String(r).slice(0,10)}T00:00:00.000Z`)},d=await s.Z.create(o),u=d.date.getUTCFullYear(),l=String(d.date.getUTCMonth()+1).padStart(2,"0"),c=String(d.date.getUTCDate()).padStart(2,"0");return e.status(201).json({ok:!0,item:{id:d._id.toString(),title:d.title,date:`${u}-${l}-${c}`,description:d.notice}})}return e.setHeader("Allow",["GET","POST"]),e.status(405).json({ok:!1,error:"Method not allowed"})}let l=(0,o.l)(r,"default"),c=(0,o.l)(r,"config"),p=new i.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/notices",pathname:"/api/notices",bundlePath:"",filename:""},userland:r})},9212:(t,e,n)=>{n.d(e,{Q:()=>d});var r=n(1185),i=n.n(r);let a=process.env.MONGODB_URI,o=null;async function d(){if(1===i().connection.readyState)return i().connection;if(!o){if(!a)throw Error("MONGODB_URI is not set");o=i().connect(a,{bufferCommands:!1}).then(t=>i().connection).catch(t=>{throw console.error("MongoDB connection error:",t.message),t})}return o}},6754:(t,e,n)=>{n.d(e,{Z:()=>o});var r=n(1185),i=n.n(r);let a=new(i()).Schema({title:{type:String,required:!0},notice:{type:String,default:""},date:{type:Date,default:Date.now}},{timestamps:!0}),o=i().models.Notice||i().model("Notice",a)},7153:(t,e)=>{var n;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return n}}),function(t){t.PAGES="PAGES",t.PAGES_API="PAGES_API",t.APP_PAGE="APP_PAGE",t.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(t,e,n)=>{t.exports=n(145)}};var e=require("../../webpack-api-runtime.js");e.C(t);var n=e(e.s=2894);module.exports=n})();